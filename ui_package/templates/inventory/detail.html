{% extends "base.html" %}

{% block title %}{{ item.item_code }} - Inventory - Laser OS{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üì¶ {{ item.item_code }} - {{ item.name }}</h1>
    <div class="page-actions">
        {% if current_user.has_role('admin') or current_user.has_role('manager') %}
        <a href="{{ url_for('inventory.edit', id=item.id) }}" class="btn btn-primary">‚úèÔ∏è Edit</a>
        <form method="POST" action="{{ url_for('inventory.delete', id=item.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this inventory item?');">
            <button type="submit" class="btn btn-danger">üóëÔ∏è Delete</button>
        </form>
        {% endif %}
        <a href="{{ url_for('inventory.index') }}" class="btn btn-secondary">‚Üê Back to Inventory</a>
    </div>
</div>

<!-- Stock Status Alert -->
{% if item.is_low_stock %}
<div class="alert alert-warning">
    ‚ö†Ô∏è <strong>Low Stock Alert!</strong> Current quantity ({{ item.quantity_on_hand }} {{ item.unit }}) is below reorder level ({{ item.reorder_level }} {{ item.unit }}).
    {% if item.reorder_quantity %}Suggested reorder quantity: {{ item.reorder_quantity }} {{ item.unit }}.{% endif %}
</div>
{% endif %}

<div class="grid grid-2">
    <!-- Item Information -->
    <div class="card">
        <div class="card-header">
            <h2>Item Information</h2>
        </div>
        <div class="card-body">
            <table class="info-table">
                <tr>
                    <th>Item Code:</th>
                    <td><strong>{{ item.item_code }}</strong></td>
                </tr>
                <tr>
                    <th>Name:</th>
                    <td>{{ item.name }}</td>
                </tr>
                <tr>
                    <th>Category:</th>
                    <td><span class="badge">{{ item.category }}</span></td>
                </tr>
                <tr>
                    <th>Material Type:</th>
                    <td>{{ item.material_type or '-' }}</td>
                </tr>
                <tr>
                    <th>Thickness:</th>
                    <td>{% if item.thickness %}{{ item.thickness }} mm{% else %}-{% endif %}</td>
                </tr>
                <tr>
                    <th>Unit:</th>
                    <td>{{ item.unit }}</td>
                </tr>
                <tr>
                    <th>Location:</th>
                    <td>{{ item.location or '-' }}</td>
                </tr>
                <tr>
                    <th>Notes:</th>
                    <td>{{ item.notes or '-' }}</td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Stock Information -->
    <div class="card">
        <div class="card-header">
            <h2>Stock Information</h2>
        </div>
        <div class="card-body">
            <table class="info-table">
                <tr>
                    <th>Quantity on Hand:</th>
                    <td><strong style="font-size: 1.2rem; color: {% if item.is_low_stock %}var(--warning-color){% else %}var(--success-color){% endif %};">{{ item.quantity_on_hand }} {{ item.unit }}</strong></td>
                </tr>
                <tr>
                    <th>Reorder Level:</th>
                    <td>{% if item.reorder_level %}{{ item.reorder_level }} {{ item.unit }}{% else %}-{% endif %}</td>
                </tr>
                <tr>
                    <th>Reorder Quantity:</th>
                    <td>{% if item.reorder_quantity %}{{ item.reorder_quantity }} {{ item.unit }}{% else %}-{% endif %}</td>
                </tr>
                <tr>
                    <th>Unit Cost:</th>
                    <td>{% if item.unit_cost %}${{ "%.2f"|format(item.unit_cost) }}{% else %}-{% endif %}</td>
                </tr>
                <tr>
                    <th>Stock Value:</th>
                    <td><strong>{% if item.stock_value %}${{ "%.2f"|format(item.stock_value) }}{% else %}-{% endif %}</strong></td>
                </tr>
                <tr>
                    <th>Status:</th>
                    <td>
                        {% if item.is_low_stock %}
                            <span class="badge badge-warning">‚ö†Ô∏è Low Stock</span>
                        {% else %}
                            <span class="badge badge-success">‚úì OK</span>
                        {% endif %}
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Supplier Information -->
    <div class="card">
        <div class="card-header">
            <h2>Supplier Information</h2>
        </div>
        <div class="card-body">
            <table class="info-table">
                <tr>
                    <th>Supplier Name:</th>
                    <td>{{ item.supplier_name or '-' }}</td>
                </tr>
                <tr>
                    <th>Supplier Contact:</th>
                    <td>{{ item.supplier_contact or '-' }}</td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Stock Adjustment -->
    {% if current_user.has_role('admin') or current_user.has_role('manager') or current_user.has_role('operator') %}
    <div class="card">
        <div class="card-header">
            <h2>Adjust Stock</h2>
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('inventory.adjust_stock', id=item.id) }}">
                <div>
                    <label for="transaction_type">Transaction Type</label>
                    <select id="transaction_type" name="transaction_type" required>
                        <option value="Purchase">Purchase (Add Stock)</option>
                        <option value="Usage">Usage (Remove Stock)</option>
                        <option value="Adjustment">Adjustment</option>
                        <option value="Return">Return (Add Stock)</option>
                        <option value="Waste">Waste (Remove Stock)</option>
                    </select>
                </div>

                <div style="margin-top: 1rem;">
                    <label for="quantity">Quantity (use negative for removal)</label>
                    <input type="number" step="0.001" id="quantity" name="quantity" required>
                    <small class="text-muted">Current: {{ item.quantity_on_hand }} {{ item.unit }}</small>
                </div>

                <div style="margin-top: 1rem;">
                    <label for="notes">Notes</label>
                    <textarea id="notes" name="notes" rows="2"></textarea>
                </div>

                <button type="submit" class="btn btn-primary" style="margin-top: 1rem;">üíæ Adjust Stock</button>
            </form>
        </div>
    </div>
    {% endif %}
</div>

<!-- Recent Transactions -->
<div class="card" style="margin-top: 1.5rem;">
    <div class="card-header">
        <h2>Recent Transactions ({{ transactions|length }})</h2>
    </div>
    <div class="card-body">
        {% if transactions %}
        <table class="table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Quantity</th>
                    <th>Unit Cost</th>
                    <th>Value</th>
                    <th>Performed By</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody>
                {% for txn in transactions %}
                <tr>
                    <td>{{ txn.transaction_date.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td><span class="badge">{{ txn.transaction_type }}</span></td>
                    <td style="color: {% if txn.quantity > 0 %}var(--success-color){% else %}var(--danger-color){% endif %};">
                        {{ "%.3f"|format(txn.quantity) }} {{ item.unit }}
                    </td>
                    <td>{% if txn.unit_cost %}${{ "%.2f"|format(txn.unit_cost) }}{% else %}-{% endif %}</td>
                    <td>{% if txn.transaction_value %}${{ "%.2f"|format(txn.transaction_value) }}{% else %}-{% endif %}</td>
                    <td>{{ txn.performed_by or '-' }}</td>
                    <td>{{ txn.notes or '-' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="text-muted">No transactions yet.</p>
        {% endif %}
    </div>
</div>

<!-- Activity Log -->
<div class="card" style="margin-top: 1.5rem;">
    <div class="card-header">
        <h2>Activity Log</h2>
    </div>
    <div class="card-body">
        {% if logs %}
        <table class="table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Action</th>
                    <th>Details</th>
                    <th>User</th>
                </tr>
            </thead>
            <tbody>
                {% for log in logs %}
                <tr>
                    <td>{{ log.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td><span class="badge">{{ log.action }}</span></td>
                    <td>{{ log.details }}</td>
                    <td>{{ log.user }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="text-muted">No activity logs.</p>
        {% endif %}
    </div>
</div>

<style>
.badge-warning {
    background-color: var(--warning-color);
    color: white;
}

.badge-success {
    background-color: var(--success-color);
    color: white;
}
</style>
{% endblock %}

