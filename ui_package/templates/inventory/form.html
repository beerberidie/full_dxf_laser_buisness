{% extends "base.html" %}

{% block title %}{% if item %}Edit{% else %}New{% endif %} Inventory Item - Laser OS{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <nav class="breadcrumb">
            <a href="{{ url_for('main.dashboard') }}">Dashboard</a>
            <span>/</span>
            <a href="{{ url_for('inventory.index') }}">Inventory</a>
            <span>/</span>
            <span>{% if item %}Edit Item{% else %}New Item{% endif %}</span>
        </nav>
        <h1>{% if item %}Edit Inventory Item{% else %}New Inventory Item{% endif %}</h1>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h2>Item Information</h2>
    </div>
    <div class="card-body">
        <form method="POST">
            <div class="grid grid-2">
                <div class="form-group">
                    <label for="item_code">Item Code *</label>
                    <input type="text" id="item_code" name="item_code" class="form-control" value="{{ item.item_code if item else '' }}" required {% if item %}readonly{% endif %}>
                    <small class="text-muted">Unique identifier for this item</small>
                </div>

                <div class="form-group">
                    <label for="name">Name *</label>
                    <input type="text" id="name" name="name" class="form-control" value="{{ item.name if item else '' }}" required>
                </div>

                <div class="form-group">
                    <label for="category">Category *</label>
                    <select id="category" name="category" class="form-control" required>
                        <option value="">Select Category</option>
                        {% for cat in categories %}
                        <option value="{{ cat }}" {% if item and item.category == cat %}selected{% endif %}>{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="unit">Unit *</label>
                    <select id="unit" name="unit" class="form-control" required>
                        <option value="">Select Unit</option>
                        {% for u in units %}
                        <option value="{{ u }}" {% if item and item.unit == u %}selected{% endif %}>{{ u }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="material_type">Material Type</label>
                    <select id="material_type" name="material_type" class="form-control">
                        <option value="">Select Material Type</option>
                        {% for mat in material_types %}
                        <option value="{{ mat }}" {% if item and item.material_type == mat %}selected{% endif %}>
                            {{ mat }}
                        </option>
                        {% endfor %}
                    </select>
                    <small class="text-muted">Select material type or leave blank if not applicable</small>
                </div>

                <div class="form-group">
                    <label for="thickness">Thickness (mm)</label>
                    <select id="thickness" name="thickness" class="form-control">
                        <option value="">Select Thickness</option>
                        {% for thick in thicknesses %}
                        <option value="{{ thick }}" {% if item and item.thickness and item.thickness|string == thick %}selected{% endif %}>
                            {{ thick }}mm
                        </option>
                        {% endfor %}
                    </select>
                    <small class="text-muted">Select thickness or leave blank if not applicable</small>
                </div>

                {% if not item %}
                <div class="form-group">
                    <label for="quantity_on_hand">Initial Quantity</label>
                    <input type="number" step="0.001" id="quantity_on_hand" name="quantity_on_hand" class="form-control" value="0">
                </div>
                {% endif %}

                <div class="form-group">
                    <label for="reorder_level">Reorder Level</label>
                    <input type="number" step="0.001" id="reorder_level" name="reorder_level" class="form-control" value="{{ item.reorder_level if item else '' }}">
                    <small class="text-muted">Alert when stock falls below this level</small>
                </div>

                <div class="form-group">
                    <label for="reorder_quantity">Reorder Quantity</label>
                    <input type="number" step="0.001" id="reorder_quantity" name="reorder_quantity" class="form-control" value="{{ item.reorder_quantity if item else '' }}">
                </div>

                <div class="form-group">
                    <label for="unit_cost">Unit Cost (R)</label>
                    <input type="number" step="0.01" id="unit_cost" name="unit_cost" class="form-control" value="{{ item.unit_cost if item else '' }}">
                </div>

                <div class="form-group">
                    <label for="supplier_name">Supplier Name</label>
                    <input type="text" id="supplier_name" name="supplier_name" class="form-control" value="{{ item.supplier_name if item else '' }}">
                </div>

                <div class="form-group">
                    <label for="supplier_contact">Supplier Contact</label>
                    <input type="text" id="supplier_contact" name="supplier_contact" class="form-control" value="{{ item.supplier_contact if item else '' }}">
                </div>

                <div class="form-group">
                    <label for="location">Storage Location</label>
                    <input type="text" id="location" name="location" class="form-control" value="{{ item.location if item else '' }}">
                </div>
            </div>

            <div class="form-group">
                <label for="notes">Notes</label>
                <textarea id="notes" name="notes" class="form-control" rows="3">{{ item.notes if item else '' }}</textarea>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Save Item</button>
                <a href="{% if item %}{{ url_for('inventory.detail', id=item.id) }}{% else %}{{ url_for('inventory.index') }}{% endif %}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>

<script>
// Allow custom material type input
document.getElementById('material_type').addEventListener('change', function() {
    if (this.value === '') {
        var custom = prompt('Enter custom material type:');
        if (custom) {
            var option = document.createElement('option');
            option.value = custom;
            option.text = custom;
            option.selected = true;
            this.add(option);
        }
    }
});

// Allow custom thickness input
document.getElementById('thickness').addEventListener('change', function() {
    if (this.value === '') {
        var custom = prompt('Enter custom thickness (mm):');
        if (custom && !isNaN(custom)) {
            var option = document.createElement('option');
            option.value = custom;
            option.text = custom + 'mm';
            option.selected = true;
            this.add(option);
        }
    }
});
</script>
{% endblock %}

