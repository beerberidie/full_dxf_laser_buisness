{% extends "base.html" %}

{% block title %}{{ client.client_code }} - {{ client.name }}{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <div class="breadcrumb">
            <a href="{{ url_for('clients.list_clients') }}">Clients</a>
            <span>/</span>
            <span>{{ client.client_code }}</span>
        </div>
        <h1>{{ client.name }}</h1>
        <p class="text-muted">{{ client.client_code }}</p>
    </div>
    <div class="page-actions">
        <a href="{{ url_for('clients.edit', id=client.id) }}" class="btn btn-secondary">
            Edit Client
        </a>
        <button onclick="confirmDelete()" class="btn btn-danger">
            Delete Client
        </button>
    </div>
</div>

<!-- Client Information -->
<div class="grid grid-2">
    <div class="card">
        <div class="card-header">
            <h2>Contact Information</h2>
        </div>
        <div class="card-body">
            <dl class="detail-list">
                <dt>Contact Person</dt>
                <dd>{{ client.contact_person or '-' }}</dd>
                
                <dt>Email</dt>
                <dd>
                    {% if client.email %}
                        <a href="mailto:{{ client.email }}">{{ client.email }}</a>
                    {% else %}
                        -
                    {% endif %}
                </dd>
                
                <dt>Phone</dt>
                <dd>
                    {% if client.phone %}
                        <a href="tel:{{ client.phone }}">{{ client.phone }}</a>
                    {% else %}
                        -
                    {% endif %}
                </dd>
                
                <dt>Address</dt>
                <dd>
                    {% if client.address %}
                        <pre style="white-space: pre-wrap; font-family: inherit; margin: 0;">{{ client.address }}</pre>
                    {% else %}
                        -
                    {% endif %}
                </dd>
            </dl>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h2>Metadata</h2>
        </div>
        <div class="card-body">
            <dl class="detail-list">
                <dt>Client Code</dt>
                <dd><code>{{ client.client_code }}</code></dd>
                
                <dt>Created</dt>
                <dd>{{ client.created_at|datetime }}</dd>
                
                <dt>Last Updated</dt>
                <dd>{{ client.updated_at|datetime }}</dd>
            </dl>
        </div>
    </div>
</div>

<!-- Notes -->
{% if client.notes %}
<div class="card">
    <div class="card-header">
        <h2>Notes</h2>
    </div>
    <div class="card-body">
        <pre style="white-space: pre-wrap; font-family: inherit;">{{ client.notes }}</pre>
    </div>
</div>
{% endif %}

<!-- Projects (will be added in Phase 2) -->
<div class="card">
    <div class="card-header">
        <h2>Projects</h2>
        <a href="{{ url_for('projects.new_project') }}?client_id={{ client.id }}" class="btn btn-sm btn-primary">
            + New Project
        </a>
    </div>
    <div class="card-body">
        <div class="empty-state-sm">
            <p>Projects feature coming in Phase 2</p>
        </div>
    </div>
</div>

<!-- Activity Log -->
<div class="card">
    <div class="card-header">
        <h2>Activity Log</h2>
    </div>
    <div class="card-body">
        {% if activities %}
            <div class="activity-log">
                {% for activity in activities %}
                <div class="activity-item">
                    <div class="activity-badge">
                        <span class="badge badge-{{ activity.action.lower() }}">
                            {{ activity.action }}
                        </span>
                    </div>
                    <div class="activity-content">
                        <p class="activity-user">{{ activity.user }}</p>
                        <p class="activity-time">{{ activity.created_at|datetime }}</p>
                        {% if activity.details %}
                            <pre class="activity-details">{{ activity.details }}</pre>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-muted">No activity recorded.</p>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function confirmDelete() {
    if (confirm('Are you sure you want to delete this client? This action cannot be undone.')) {
        // Create and submit a form for DELETE request
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{{ url_for("clients.delete", id=client.id) }}';
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}

