{% extends "base.html" %}

{% block title %}{{ product.sku_code }} - Laser OS{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <nav class="breadcrumb">
            <a href="{{ url_for('main.dashboard') }}">Dashboard</a>
            <span>/</span>
            <a href="{{ url_for('products.index') }}">Products</a>
            <span>/</span>
            <span>{{ product.sku_code }}</span>
        </nav>
        <h1>{{ product.name }}</h1>
        <p class="text-muted">SKU: {{ product.sku_code }}</p>
    </div>
    <div>
        <a href="{{ url_for('products.edit', id=product.id) }}" class="btn btn-primary">Edit Product</a>
        <form method="POST" action="{{ url_for('products.delete', id=product.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this product?');">
            <button type="submit" class="btn btn-danger">Delete Product</button>
        </form>
    </div>
</div>

<div class="grid grid-2">
    <!-- Product Information -->
    <div class="card">
        <div class="card-header">
            <h2>Product Information</h2>
        </div>
        <div class="card-body">
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">SKU Code:</span>
                    <span class="info-value">{{ product.sku_code }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Name:</span>
                    <span class="info-value">{{ product.name }}</span>
                </div>
                {% if product.description %}
                <div class="info-item full-width">
                    <span class="info-label">Description:</span>
                    <span class="info-value">{{ product.description }}</span>
                </div>
                {% endif %}
                <div class="info-item">
                    <span class="info-label">Material:</span>
                    <span class="info-value">{{ product.material or '-' }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Thickness:</span>
                    <span class="info-value">
                        {% if product.thickness %}
                            {{ product.thickness }}mm
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </div>
                <div class="info-item">
                    <span class="info-label">Unit Price:</span>
                    <span class="info-value">
                        {% if product.unit_price %}
                            R{{ "%.2f"|format(product.unit_price) }}
                        {% else %}
                            -
                        {% endif %}
                    </span>
                </div>
                {% if product.notes %}
                <div class="info-item full-width">
                    <span class="info-label">Notes:</span>
                    <span class="info-value">{{ product.notes }}</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Metadata -->
    <div class="card">
        <div class="card-header">
            <h2>Metadata</h2>
        </div>
        <div class="card-body">
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Created:</span>
                    <span class="info-value">{{ product.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Last Updated:</span>
                    <span class="info-value">{{ product.updated_at.strftime('%Y-%m-%d %H:%M') }}</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Projects Using This Product -->
<div class="card">
    <div class="card-header">
        <h2>Projects Using This Product ({{ project_products|length }})</h2>
    </div>
    {% if project_products %}
    <table class="table">
        <thead>
            <tr>
                <th>Project Code</th>
                <th>Project Name</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Total</th>
                <th>Added</th>
            </tr>
        </thead>
        <tbody>
            {% for pp in project_products %}
            <tr>
                <td>
                    <a href="{{ url_for('projects.detail', id=pp.project.id) }}" class="link">
                        {{ pp.project.project_code }}
                    </a>
                </td>
                <td>{{ pp.project.name }}</td>
                <td>{{ pp.quantity }}</td>
                <td>
                    {% if pp.unit_price %}
                        R{{ "%.2f"|format(pp.unit_price) }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    {% if pp.unit_price %}
                        R{{ "%.2f"|format(pp.total_price) }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>{{ pp.created_at.strftime('%Y-%m-%d') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <p>This product has not been used in any projects yet.</p>
    </div>
    {% endif %}
</div>

<!-- Activity Log -->
<div class="card">
    <div class="card-header">
        <h2>Activity Log</h2>
    </div>
    {% if activity_logs %}
    <table class="table">
        <thead>
            <tr>
                <th>Date/Time</th>
                <th>Action</th>
                <th>User</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for log in activity_logs %}
            <tr>
                <td>{{ log.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                <td><span class="badge badge-{{ log.action.lower() }}">{{ log.action }}</span></td>
                <td>{{ log.user or 'System' }}</td>
                <td>{{ log.details or '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <p>No activity logged yet.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

