{% extends "base.html" %}

{% block title %}{% if project %}Edit Project{% else %}New Project{% endif %}{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <div class="breadcrumb">
            <a href="{{ url_for('projects.index') }}">Projects</a>
            <span>/</span>
            {% if project %}
                <a href="{{ url_for('projects.detail', id=project.id) }}">{{ project.project_code }}</a>
                <span>/</span>
                <span>Edit</span>
            {% else %}
                <span>New</span>
            {% endif %}
        </div>
        <h1>{% if project %}Edit Project{% else %}New Project{% endif %}</h1>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <form method="post" class="form">
            <!-- Client Selection (only for new projects) -->
            {% if not project %}
            <div class="form-group">
                <label for="client_id" class="form-label required">Client</label>
                <select 
                    id="client_id" 
                    name="client_id" 
                    class="form-control" 
                    required
                >
                    <option value="">Select a client...</option>
                    {% for client in clients %}
                        <option value="{{ client.id }}">
                            {{ client.name }} ({{ client.client_code }})
                        </option>
                    {% endfor %}
                </select>
                <small class="form-help">Select the client for this project</small>
            </div>
            {% else %}
            <div class="form-group">
                <label class="form-label">Client</label>
                <div class="form-control-static">
                    <a href="{{ url_for('clients.detail', id=project.client.id) }}" class="link-primary">
                        {{ project.client.name }} ({{ project.client.client_code }})
                    </a>
                </div>
                <small class="form-help">Client cannot be changed after project creation</small>
            </div>
            {% endif %}

            <!-- Project Name -->
            <div class="form-group">
                <label for="name" class="form-label required">Project Name</label>
                <input 
                    type="text" 
                    id="name" 
                    name="name" 
                    class="form-control" 
                    value="{{ project.name if project else '' }}"
                    required
                    placeholder="e.g., Custom Metal Brackets"
                >
                <small class="form-help">A descriptive name for the project</small>
            </div>

            <!-- Description -->
            <div class="form-group">
                <label for="description" class="form-label">Description</label>
                <textarea 
                    id="description" 
                    name="description" 
                    class="form-control" 
                    rows="4"
                    placeholder="Detailed description of the project..."
                >{{ project.description if project else '' }}</textarea>
                <small class="form-help">Detailed description of the project requirements</small>
            </div>

            <!-- Status -->
            <div class="form-group">
                <label for="status" class="form-label required">Status</label>
                <select 
                    id="status" 
                    name="status" 
                    class="form-control" 
                    required
                >
                    {% for status in statuses %}
                        <option value="{{ status }}" {% if project and project.status == status %}selected{% endif %}>
                            {{ status }}
                        </option>
                    {% endfor %}
                </select>
                <small class="form-help">Current project status</small>
            </div>

            <!-- Timeline Section -->
            <div class="form-section">
                <h3>Timeline</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="quote_date" class="form-label">Quote Date</label>
                        <input 
                            type="date" 
                            id="quote_date" 
                            name="quote_date" 
                            class="form-control" 
                            value="{{ project.quote_date if project and project.quote_date else '' }}"
                        >
                        <small class="form-help">Date the quote was provided</small>
                    </div>

                    <div class="form-group">
                        <label for="approval_date" class="form-label">Approval Date</label>
                        <input 
                            type="date" 
                            id="approval_date" 
                            name="approval_date" 
                            class="form-control" 
                            value="{{ project.approval_date if project and project.approval_date else '' }}"
                        >
                        <small class="form-help">Date the project was approved</small>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="due_date" class="form-label">Due Date</label>
                        <input 
                            type="date" 
                            id="due_date" 
                            name="due_date" 
                            class="form-control" 
                            value="{{ project.due_date if project and project.due_date else '' }}"
                        >
                        <small class="form-help">Project deadline</small>
                    </div>

                    {% if project %}
                    <div class="form-group">
                        <label for="completion_date" class="form-label">Completion Date</label>
                        <input 
                            type="date" 
                            id="completion_date" 
                            name="completion_date" 
                            class="form-control" 
                            value="{{ project.completion_date if project and project.completion_date else '' }}"
                        >
                        <small class="form-help">Date the project was completed</small>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Material & Production Section (Phase 9) -->
            <div class="form-section">
                <h3>Material & Production Information</h3>

                <div class="form-row">
                    <div class="form-group">
                        <label for="material_type" class="form-label">Material Type</label>
                        <select
                            id="material_type"
                            name="material_type"
                            class="form-control"
                        >
                            <option value="">Select material...</option>
                            {% for material in material_types %}
                                <option value="{{ material }}" {% if project and project.material_type == material %}selected{% endif %}>
                                    {{ material }}
                                </option>
                            {% endfor %}
                        </select>
                        <small class="form-help">Type of material to be cut</small>
                    </div>

                    <div class="form-group">
                        <label for="material_quantity_sheets" class="form-label">Material Quantity (Sheets)</label>
                        <input
                            type="number"
                            id="material_quantity_sheets"
                            name="material_quantity_sheets"
                            class="form-control"
                            value="{{ project.material_quantity_sheets if project and project.material_quantity_sheets else '' }}"
                            min="0"
                            placeholder="e.g., 5"
                        >
                        <small class="form-help">Number of sheets required</small>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="parts_quantity" class="form-label">Parts Quantity</label>
                        <input
                            type="number"
                            id="parts_quantity"
                            name="parts_quantity"
                            class="form-control"
                            value="{{ project.parts_quantity if project and project.parts_quantity else '' }}"
                            min="0"
                            placeholder="e.g., 100"
                        >
                        <small class="form-help">Total number of parts to produce</small>
                    </div>

                    <div class="form-group">
                        <label for="number_of_bins" class="form-label">Number of Bins</label>
                        <input
                            type="number"
                            id="number_of_bins"
                            name="number_of_bins"
                            class="form-control"
                            value="{{ project.number_of_bins if project and project.number_of_bins else '' }}"
                            min="0"
                            placeholder="e.g., 2"
                        >
                        <small class="form-help">Number of bins for storage</small>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="estimated_cut_time" class="form-label">Estimated Cut Time (minutes)</label>
                        <input
                            type="number"
                            id="estimated_cut_time"
                            name="estimated_cut_time"
                            class="form-control"
                            value="{{ project.estimated_cut_time if project and project.estimated_cut_time else '' }}"
                            min="0"
                            placeholder="e.g., 45"
                        >
                        <small class="form-help">Estimated laser cutting time</small>
                    </div>

                    <div class="form-group">
                        <label for="drawing_creation_time" class="form-label">Drawing Creation Time (minutes)</label>
                        <input
                            type="number"
                            id="drawing_creation_time"
                            name="drawing_creation_time"
                            class="form-control"
                            value="{{ project.drawing_creation_time if project and project.drawing_creation_time else '' }}"
                            min="0"
                            placeholder="e.g., 30"
                        >
                        <small class="form-help">Time spent creating/preparing drawings</small>
                    </div>
                </div>

                <div class="form-group">
                    <label for="scheduled_cut_date" class="form-label">Scheduled Cut Date</label>
                    <input
                        type="date"
                        id="scheduled_cut_date"
                        name="scheduled_cut_date"
                        class="form-control"
                        value="{{ project.scheduled_cut_date if project and project.scheduled_cut_date else '' }}"
                    >
                    <small class="form-help">Planned date for laser cutting</small>
                </div>
            </div>

            <!-- Pricing Section -->
            <div class="form-section">
                <h3>Pricing</h3>

                <div class="form-row">
                    <div class="form-group">
                        <label for="quoted_price" class="form-label">Quoted Price (R)</label>
                        <input
                            type="number"
                            id="quoted_price"
                            name="quoted_price"
                            class="form-control"
                            value="{{ project.quoted_price if project and project.quoted_price else '' }}"
                            step="0.01"
                            min="0"
                            placeholder="0.00"
                        >
                        <small class="form-help">Initial quoted price</small>
                    </div>

                    {% if project %}
                    <div class="form-group">
                        <label for="final_price" class="form-label">Final Price (R)</label>
                        <input
                            type="number"
                            id="final_price"
                            name="final_price"
                            class="form-control"
                            value="{{ project.final_price if project and project.final_price else '' }}"
                            step="0.01"
                            min="0"
                            placeholder="0.00"
                        >
                        <small class="form-help">Final invoiced price</small>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Notes -->
            <div class="form-group">
                <label for="notes" class="form-label">Notes</label>
                <textarea 
                    id="notes" 
                    name="notes" 
                    class="form-control" 
                    rows="4"
                    placeholder="Additional notes or comments..."
                >{{ project.notes if project else '' }}</textarea>
                <small class="form-help">Any additional notes or comments</small>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    {% if project %}Update Project{% else %}Create Project{% endif %}
                </button>
                <a href="{% if project %}{{ url_for('projects.detail', id=project.id) }}{% else %}{{ url_for('projects.index') }}{% endif %}" class="btn btn-ghost">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<style>
.form-section {
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid #e0e0e0;
}

.form-section h3 {
    margin-bottom: 1rem;
    font-size: 1.25rem;
    color: #333;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
}

.form-control-static {
    padding: 0.75rem 0;
    font-size: 1rem;
}
</style>
{% endblock %}

