{% extends "base.html" %}

{% block title %}{{ operator.name }} - Operators - Laser OS{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üë∑ {{ operator.name }}</h1>
    <div class="page-actions">
        {% if current_user.has_role('admin') or current_user.has_role('manager') %}
        <a href="{{ url_for('operators.edit', id=operator.id) }}" class="btn btn-primary">‚úèÔ∏è Edit</a>
        <form method="POST" action="{{ url_for('operators.toggle_active', id=operator.id) }}" style="display: inline;">
            <button type="submit" class="btn btn-secondary">
                {{ 'üî¥ Deactivate' if operator.is_active else 'üü¢ Activate' }}
            </button>
        </form>
        {% endif %}
        {% if current_user.has_role('admin') %}
        <form method="POST" action="{{ url_for('operators.delete', id=operator.id) }}" 
              style="display: inline;"
              onsubmit="return confirm('Are you sure you want to delete this operator? This action cannot be undone.');">
            <button type="submit" class="btn btn-danger">üóëÔ∏è Delete</button>
        </form>
        {% endif %}
        <a href="{{ url_for('operators.list') }}" class="btn btn-secondary">‚Üê Back to List</a>
    </div>
</div>

<!-- Operator Information -->
<div class="card">
    <div class="card-header">
        <h2>Operator Information</h2>
    </div>
    <div class="card-body">
        <div class="info-grid">
            <div class="info-item">
                <label>Name</label>
                <div class="value">{{ operator.name }}</div>
            </div>
            
            <div class="info-item">
                <label>Status</label>
                <div class="value">
                    {% if operator.is_active %}
                    <span class="badge badge-success">Active</span>
                    {% else %}
                    <span class="badge badge-secondary">Inactive</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="info-item">
                <label>Email</label>
                <div class="value">
                    {% if operator.email %}
                    <a href="mailto:{{ operator.email }}">{{ operator.email }}</a>
                    {% else %}
                    <span class="text-muted">Not provided</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="info-item">
                <label>Phone</label>
                <div class="value">
                    {% if operator.phone %}
                    <a href="tel:{{ operator.phone }}">{{ operator.phone }}</a>
                    {% else %}
                    <span class="text-muted">Not provided</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="info-item">
                <label>User Account</label>
                <div class="value">
                    {% if operator.user %}
                    <span class="badge badge-info">{{ operator.user.username }}</span>
                    <small class="text-muted">({{ operator.user.full_name or 'No name' }})</small>
                    {% else %}
                    <span class="text-muted">No linked account</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="info-item">
                <label>Total Laser Runs</label>
                <div class="value">
                    <strong>{{ operator.laser_run_count }}</strong> run{{ 's' if operator.laser_run_count != 1 else '' }}
                </div>
            </div>
            
            <div class="info-item">
                <label>Created</label>
                <div class="value">
                    <small class="text-muted">{{ operator.created_at.strftime('%Y-%m-%d %H:%M') if operator.created_at else 'Unknown' }}</small>
                </div>
            </div>
            
            <div class="info-item">
                <label>Last Updated</label>
                <div class="value">
                    <small class="text-muted">{{ operator.updated_at.strftime('%Y-%m-%d %H:%M') if operator.updated_at else 'Unknown' }}</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Laser Runs -->
<div class="card">
    <div class="card-header">
        <h2>Recent Laser Runs (Last 10)</h2>
    </div>
    <div class="card-body">
        {% if recent_runs %}
        <table class="table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Project</th>
                    <th>Material</th>
                    <th>Sheets</th>
                    <th>Parts</th>
                    <th>Cut Time</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for run in recent_runs %}
                <tr>
                    <td>
                        <small>{{ run.run_date.strftime('%Y-%m-%d %H:%M') if run.run_date else 'N/A' }}</small>
                    </td>
                    <td>
                        {% if run.project %}
                        <a href="{{ url_for('projects.detail', id=run.project.id) }}">
                            {{ run.project.project_code }}
                        </a>
                        {% else %}
                        <span class="text-muted">No project</span>
                        {% endif %}
                    </td>
                    <td>
                        <small>
                            {{ run.material_type or 'N/A' }}
                            {% if run.material_thickness %}
                            ({{ run.material_thickness }}mm)
                            {% endif %}
                        </small>
                    </td>
                    <td>{{ run.sheet_count or 0 }}</td>
                    <td>{{ run.parts_produced or 0 }}</td>
                    <td>
                        {% if run.cut_time_minutes %}
                        {{ run.cut_time_minutes }} min
                        {% else %}
                        <span class="text-muted">N/A</span>
                        {% endif %}
                    </td>
                    <td>
                        <span class="badge badge-{{ 'success' if run.status == 'Completed' else 'warning' }}">
                            {{ run.status or 'Unknown' }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <p>No laser runs recorded yet.</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
.info-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
}

@media (max-width: 768px) {
    .info-grid {
        grid-template-columns: 1fr;
    }
}

.info-item {
    padding: 0.75rem;
    background: #f8f9fa;
    border-radius: 4px;
}

.info-item label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    color: #666;
    margin-bottom: 0.25rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.info-item .value {
    font-size: 1rem;
    color: #333;
}

.empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: #666;
}

.empty-state p {
    font-size: 1.1rem;
    margin: 0;
}

.table {
    width: 100%;
    border-collapse: collapse;
}

.table th,
.table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid #e0e0e0;
}

.table th {
    background: #f8f9fa;
    font-weight: 600;
    color: #333;
}

.table tbody tr:hover {
    background: #f8f9fa;
}

.text-muted {
    color: #666;
}

.badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
    font-weight: 500;
    border-radius: 4px;
}

.badge-success {
    background: #28a745;
    color: white;
}

.badge-secondary {
    background: #6c757d;
    color: white;
}

.badge-info {
    background: #17a2b8;
    color: white;
}

.badge-warning {
    background: #ffc107;
    color: #333;
}
</style>
{% endblock %}

