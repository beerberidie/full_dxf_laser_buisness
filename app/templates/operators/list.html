{% extends "base.html" %}

{% block title %}Operators - Laser OS{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üë∑ Operators</h1>
    <div class="page-actions">
        {% if current_user.has_role('admin') or current_user.has_role('manager') %}
        <a href="{{ url_for('operators.new') }}" class="btn btn-primary">‚ûï Add Operator</a>
        {% endif %}
    </div>
</div>

<!-- Search and Filters -->
<div class="card">
    <div class="card-body">
        <form method="GET" action="{{ url_for('operators.list') }}" class="filter-form">
            <div class="form-row">
                <div class="form-group">
                    <input type="text" name="search" class="form-control" 
                           placeholder="Search operators..." 
                           value="{{ search }}">
                </div>
                
                <div class="form-group">
                    <select name="active" class="form-control">
                        <option value="">All Statuses</option>
                        <option value="1" {% if active_filter == '1' %}selected{% endif %}>Active Only</option>
                        <option value="0" {% if active_filter == '0' %}selected{% endif %}>Inactive Only</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-secondary">üîç Filter</button>
                    <a href="{{ url_for('operators.list') }}" class="btn btn-secondary">Clear</a>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Operators List -->
<div class="card">
    <div class="card-header">
        <h2>Operators ({{ operators|length }})</h2>
    </div>
    <div class="card-body">
        {% if operators %}
        <table class="table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Contact</th>
                    <th>User Account</th>
                    <th>Status</th>
                    <th>Laser Runs</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for operator in operators %}
                <tr>
                    <td>
                        <strong>{{ operator.name }}</strong>
                    </td>
                    <td>
                        {% if operator.email %}
                        <small>üìß {{ operator.email }}</small><br>
                        {% endif %}
                        {% if operator.phone %}
                        <small>üìû {{ operator.phone }}</small>
                        {% endif %}
                        {% if not operator.email and not operator.phone %}
                        <small class="text-muted">No contact info</small>
                        {% endif %}
                    </td>
                    <td>
                        {% if operator.user %}
                        <span class="badge badge-info">{{ operator.user.username }}</span>
                        {% else %}
                        <small class="text-muted">No account</small>
                        {% endif %}
                    </td>
                    <td>
                        {% if operator.is_active %}
                        <span class="badge badge-success">Active</span>
                        {% else %}
                        <span class="badge badge-secondary">Inactive</span>
                        {% endif %}
                    </td>
                    <td>
                        <small class="text-muted">
                            {{ operator.laser_run_count }} run{{ 's' if operator.laser_run_count != 1 else '' }}
                        </small>
                    </td>
                    <td>
                        <div style="display: flex; gap: 0.5rem;">
                            <a href="{{ url_for('operators.detail', id=operator.id) }}"
                               class="btn btn-sm btn-secondary" title="View Details">
                                üëÅÔ∏è View
                            </a>
                            {% if current_user.has_role('admin') or current_user.has_role('manager') %}
                            <a href="{{ url_for('operators.edit', id=operator.id) }}"
                               class="btn btn-sm btn-secondary" title="Edit">
                                ‚úèÔ∏è Edit
                            </a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <p>No operators found.</p>
            {% if current_user.has_role('admin') or current_user.has_role('manager') %}
            <a href="{{ url_for('operators.new') }}" class="btn btn-primary">‚ûï Add First Operator</a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>

<style>
.filter-form .form-row {
    display: grid;
    grid-template-columns: 2fr 1fr auto;
    gap: 1rem;
    align-items: end;
}

@media (max-width: 768px) {
    .filter-form .form-row {
        grid-template-columns: 1fr;
    }
}

.empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: #666;
}

.empty-state p {
    font-size: 1.1rem;
    margin-bottom: 1.5rem;
}
</style>
{% endblock %}

